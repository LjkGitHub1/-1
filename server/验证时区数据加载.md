# 验证时区数据加载

## 警告信息说明

您看到的警告信息是**正常的**：
- `iso3166.tab` - 国家代码表
- `leap-seconds.list` - 闰秒列表
- `leapseconds` - 闰秒数据
- `tzdata.zi` - 时区数据压缩文件
- `zone.tab` - 时区表
- `zone1970.tab` - 时区表（1970年后）
- `zonenow.tab` - 当前时区表

这些文件不是时区定义文件，`mysql_tzinfo_to_sql` 会正确跳过它们。**真正的时区数据文件（如 `Asia/Shanghai`）应该已经成功加载。**

## 验证步骤

### 1. 检查时区数据是否已加载

```bash
mysql -u root -p -e "SELECT COUNT(*) FROM mysql.time_zone_name;"
```

**应该返回一个大于 0 的数字（通常是 1000+）。**

如果返回 0，说明时区数据未加载成功。

### 2. 验证特定时区

```bash
mysql -u root -p -e "SELECT * FROM mysql.time_zone_name WHERE Name = 'Asia/Shanghai';"
```

应该能看到 `Asia/Shanghai` 时区。

### 3. 查看一些时区示例

```bash
mysql -u root -p -e "SELECT * FROM mysql.time_zone_name WHERE Name LIKE 'Asia/%' LIMIT 10;"
```

应该能看到多个 Asia 时区。

### 4. 运行诊断脚本

```bash
cd server
python check_timezone.py
```

**应该看到：**
- 时区数据：`mysql.time_zone_name 表中的记录数` 大于 0
- 不再显示 "⚠️ 时区数据未加载!" 警告

### 5. 重启 Django 服务

```bash
# 在宝塔面板中重启 Python 项目
# 或使用命令重启 Django 服务
```

### 6. 测试 API

```bash
curl http://127.0.0.1:8896/api/system/dashboard/today-operate-total
```

应该返回正常数据，而不是 500 错误。

## 如果时区数据仍然为 0

### 检查 MySQL 权限

```bash
# 检查当前用户是否有权限
mysql -u root -p -e "SHOW GRANTS FOR 'root'@'localhost';"
```

### 手动加载时区数据

如果自动加载失败，可以尝试：

```bash
# 方法 1：使用完整路径
/usr/bin/mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql

# 方法 2：只加载特定时区（测试用）
mysql_tzinfo_to_sql /usr/share/zoneinfo/Asia/Shanghai | mysql -u root -p mysql
```

### 检查 MySQL 日志

```bash
tail -f /var/log/mysql/error.log
```

查看是否有相关错误信息。

## 成功标志

当时区数据成功加载后：
- ✅ `SELECT COUNT(*) FROM mysql.time_zone_name;` 返回大于 0
- ✅ `SELECT * FROM mysql.time_zone_name WHERE Name = 'Asia/Shanghai';` 有结果
- ✅ 诊断脚本不再显示 "时区数据未加载" 警告
- ✅ API 测试正常
- ✅ 前端不再显示时区错误





